{% extends 'base.html.twig' %}

{% block title %}Articles Management{% endblock %}

{% block body %}
<div class="max-w-7xl mx-auto my-8 px-5">
    <header class="flex justify-between items-center mb-8">
        <h1 class="text-3xl font-bold text-gray-800">Articles Management</h1>
        <div class="flex gap-3">
            <a href="{{ path('admin_dashboard') }}" class="px-5 py-2.5 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors">
                ‚Üê Back to Dashboard
            </a>
            <a href="{{ path('admin_article_new') }}" class="px-5 py-2.5 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors">
                + New Article
            </a>
        </div>
    </header>

    {% for message in app.flashes('success') %}
        <div class="p-4 mb-5 bg-green-100 border border-green-300 text-green-800 rounded-lg">
            {{ message }}
        </div>
    {% endfor %}

    {% for message in app.flashes('error') %}
        <div class="p-4 mb-5 bg-red-100 border border-red-300 text-red-800 rounded-lg">
            {{ message }}
        </div>
    {% endfor %}

    {% if articles is empty %}
        <div class="text-center py-16 bg-gray-50 rounded-lg">
            <h3 class="text-2xl font-semibold text-gray-700 mb-3">No articles yet</h3>
            <p class="text-gray-600 mb-6">Start by creating your first article!</p>
            <a href="{{ path('admin_article_new') }}" class="inline-block px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors">
                Create First Article
            </a>
        </div>
    {% else %}
        <div class="bg-white rounded-lg shadow-md overflow-hidden">
            <table class="w-full">
                <thead>
                    <tr class="bg-gray-50 border-b-2 border-gray-200">
                        <th class="px-4 py-4 text-left text-sm font-semibold text-gray-700">ID</th>
                        <th class="px-4 py-4 text-left text-sm font-semibold text-gray-700">Title</th>
                        <th class="px-4 py-4 text-left text-sm font-semibold text-gray-700">Description</th>
                        <th class="px-4 py-4 text-left text-sm font-semibold text-gray-700">Created At</th>
                        <th class="px-4 py-4 text-center text-sm font-semibold text-gray-700">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200">
                    {% for article in articles %}
                        <tr class="hover:bg-gray-50 transition-colors">
                            <td class="px-4 py-4 text-gray-700">{{ article.id }}</td>
                            <td class="px-4 py-4 font-semibold text-gray-900">{{ article.title }}</td>
                            <td class="px-4 py-4 text-gray-600">{{ article.description|length > 100 ? article.description|slice(0, 100) ~ '...' : article.description }}</td>
                            <td class="px-4 py-4 text-gray-600">{{ article.createdAt|date('Y-m-d H:i') }}</td>
                            <td class="px-4 py-4 text-center">
                                <div class="flex justify-center gap-2">
                                    <a href="{{ path('admin_article_show', {id: article.id}) }}" class="px-3 py-1.5 bg-cyan-600 hover:bg-cyan-700 text-white text-sm rounded transition-colors">
                                        View
                                    </a>
                                    <a href="{{ path('admin_article_edit', {id: article.id}) }}" class="px-3 py-1.5 bg-yellow-500 hover:bg-yellow-600 text-gray-900 text-sm rounded transition-colors">
                                        Edit
                                    </a>
                                    {% if is_granted('ARTICLE_DELETE', article) %}
                                        <form method="post" action="{{ path('admin_article_delete', {id: article.id}) }}" class="inline" onsubmit="return confirm('Are you sure you want to delete this article?');">
                                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ article.id) }}">
                                            <button type="submit" class="px-3 py-1.5 bg-red-600 hover:bg-red-700 text-white text-sm rounded transition-colors">
                                                Delete
                                            </button>
                                        </form>
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="mt-5 text-center text-gray-600">
            Total: {{ articles|length }} article(s)
        </div>
    {% endif %}
</div>
{% endblock %}
